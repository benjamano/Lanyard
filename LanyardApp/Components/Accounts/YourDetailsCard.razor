@using LanyardApp.Services
@inject IToastService ToastService

<FluentCard Class="mb-2">
    <FluentStack Orientation="Orientation.Vertical" VerticalGap="16">
        <FluentLabel Typo="Typography.H5">Your Details</FluentLabel>
        
        <EditForm Model="@model" class="w-50">
            <DataAnnotationsValidator />
            <FluentStack Orientation="Orientation.Vertical" VerticalGap="16">
                <FluentTextField @bind-Value="model.UserName"
                                 Label="User Name"
                                 ReadOnly="true"
                                 Disabled="true"
                                 Style="width: 100%;">
                    <FluentIcon Value="@(new Icons.Regular.Size16.Person())" Slot="start" />
                </FluentTextField>
                <FluentValidationMessage For="@(() => model.UserName)" />
                <FluentTextField @bind-Value="model.FirstName"
                                 Label="First Name"
                                 Required
                                 Placeholder="Enter your first name"
                                 Style="width: 100%;">
                    <FluentIcon Value="@(new Icons.Regular.Size16.Person())" Slot="start" />
                </FluentTextField>
                <FluentValidationMessage For="@(() => model.FirstName)" />
                <FluentTextField @bind-Value="model.LastName"
                                 Label="Last Name"
                                 Required
                                 Placeholder="Enter your last name"
                                 Style="width: 100%;">
                    <FluentIcon Value="@(new Icons.Regular.Size16.Person())" Slot="start" />
                </FluentTextField>
                <FluentValidationMessage For="@(() => model.LastName)" />
            </FluentStack>
        </EditForm>
    </FluentStack>
</FluentCard>

@code {
    private UserDetailsModel model = new();

    protected override async Task OnInitializedAsync()
    {
        UserProfile? user = await _sApi.GetCurrentUserProfileAsync();

        if (user is not null)
        {
            model.UserName = user.UserName!;
            model.FirstName = user.FirstName;
            model.LastName = user.LastName;
        }
    }

    public async Task HandleSave()
    {
        UserProfile? user = await _sApi.GetCurrentUserProfileAsync();

        if (user is not null)
        {
            user.FirstName = model.FirstName;
            user.LastName = model.LastName;

            await _sApi.UpdateUserProfileAsync(user);

            ToastService.ShowSuccess("Details Saved!");
        }
    }

    private class UserDetailsModel
    {
        public string UserName { get; set; } = string.Empty;
        
        [Required(ErrorMessage = "First name is required.")]
        public string? FirstName { get; set; }
        
        [Required(ErrorMessage = "Last name is required.")]
        public string? LastName { get; set; }
    }
}
